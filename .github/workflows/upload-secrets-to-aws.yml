name: Hardcoded Upload to AWS SSM

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    env:
      # üîê AWS credentials for testing (not recommended for production)
      AWS_ACCESS_KEY_ID: ASIA2YTIIEU5IJJFY3A7
      AWS_SECRET_ACCESS_KEY: KkFLePEb+SB6tQZJonIazIqXzFhxyjuhD6ZbMHON
      AWS_SESSION_TOKEN: IQoJb3JpZ2luX2VjENL//////////... (truncated for brevity)
      AWS_REGION: us-west-2

    steps:
      - name: Install AWS CLI
        run: |
          sudo apt-get update && sudo apt-get install -y awscli

      - name: Test AWS Connection
        run: |
          echo "üîê Testing AWS credentials..."
          aws sts get-caller-identity

      - name: Upload GitHub Secret to AWS SSM
        env:
          MY_SECRET: ${{ secrets.MY_SECRET }}
        run: |
          echo "üîí Uploading GitHub secret MY_SECRET to AWS SSM..."
          aws ssm put-parameter \
            --name "/test/MY_SECRET" \
            --value "$MY_SECRET" \
            --type "SecureString" \
            --region "$AWS_REGION" \
            --overwrite
          echo "‚úÖ MY_SECRET uploaded"

      - name: Upload GitHub Variable to AWS SSM
        env:
          MY_VAR: ${{ vars.MY_VAR }}
        run: |
          echo "üìù Uploading GitHub variable MY_VAR to AWS SSM..."
          aws ssm put-parameter \
            --name "/test/MY_VAR" \
            --value "$MY_VAR" \
            --type "String" \
            --region "$AWS_REGION" \
            --overwrite
          echo "‚úÖ MY_VAR uploaded"

      - name: Retrieve Uploaded Parameters from SSM
        run: |
          echo "üì• Retrieving parameters from AWS SSM:"
          
          echo "üîí SecureStrings:"
          aws ssm get-parameters-by-path \
            --path "/test/" \
            --parameter-filters "Key=Type,Values=SecureString" \
            --with-decryption \
            --query "Parameters[*].{Name:Name,Value:Value}" \
            --output table

          echo "üìù Strings:"
          aws ssm get-parameters-by-path \
            --path "/test/" \
            --parameter-filters "Key=Type,Values=String" \
            --query "Parameters[*].{Name:Name,Value:Value}" \
            --output table

          echo "‚úÖ Retrieval complete!"
